<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>The Last Bite — Cover & Fullscreen (with back hint)</title>
<style>
  html, body { margin:0; padding:0; width:100%; height:100%; overflow:hidden; background:#f7f2e9; }

  /* Main SVG container (inline injected) */
  #svgWrap { width:100vw; height:100vh; position:relative; z-index:1; }
  #svgWrap svg { width:100%; height:100%; display:block; }

  .svg-hot { cursor:pointer; outline:none; }
  .svg-hot:hover { filter:drop-shadow(0 0 0.6px #0f3d1e) brightness(0.98); }

  /* Modal */
  .modal { position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.55); z-index:2000; padding:2vmin; }
  .modal.open { display:flex; }
  .card { position:relative; background:#fff; border-radius:16px; box-shadow:0 12px 32px rgba(0,0,0,.25); display:inline-block; max-width:96vw; max-height:96vh; }
  .card img { display:block; width:auto; height:auto; max-width:96vw; max-height:96vh; object-fit:contain; background:#fff; border-radius:16px; }
  .close { position:absolute; top:6px; right:6px; border:0; padding:8px 10px; border-radius:10px; background:#fff; cursor:pointer; box-shadow:0 2px 10px rgba(0,0,0,.15); }
  .tag { position:absolute; left:10px; bottom:10px; background:#ffffffcc; border:1px solid #e7e7e7; border-radius:10px; padding:6px 10px; font-size:14px; }

  /* Cover */
  #cover {
    position:fixed; inset:0; z-index:3000; cursor:pointer;
    display:flex; align-items:flex-end; justify-content:center;
    background:#f7f2e9 center/cover no-repeat;
    transition:opacity .45s ease;
  }
  .hint {
    margin:3vmin; padding:.6rem .9rem;
    background:#ffffffcc; border:1px solid #e8e8e8; border-radius:12px;
    font:500 14px/1 system-ui, -apple-system, "Noto Sans KR", sans-serif;
    user-select:none; backdrop-filter:saturate(1.2) blur(2px);
  }
  #cover.hide { opacity:0; pointer-events:none; }

  /* Back hint on main screen */
  #backHint{
    position:fixed;
    left:50%;
    bottom: calc(env(safe-area-inset-bottom, 0px) + 16px);
    transform:translateX(-50%);
    z-index:2500;
    display:none;
    cursor:pointer;
  }
  #backHint.show{ display:block; }
</style>
</head>
<body>
  <!-- Cover -->
  <div id="cover" role="button" aria-label="Enter">
    <div class="hint">Tap / Click to enter</div>
  </div>

  <!-- Back hint on main -->
  <div id="backHint" class="hint" role="button" tabindex="0" aria-label="Back to cover">
    Tap / Click to go back
  </div>

  <!-- SVG will be injected inline here -->
  <div id="svgWrap" aria-label="Toxic mushrooms map"></div>

  <!-- Modal -->
  <div id="modal" class="modal" aria-modal="true" role="dialog">
    <div class="card">
      <button class="close" id="btnClose">✕</button>
      <img id="infoImg" alt="">
      <div class="tag" id="speciesTag"></div>
    </div>
  </div>

<script>
(() => {
  const SVG_FILE    = "THELASTBITEMAINPAGE.svg";
  const COVER_IMAGE = "images/cover.png";

  const cover    = document.getElementById("cover");
  const backHint = document.getElementById("backHint");
  const svgWrap  = document.getElementById("svgWrap");
  const modal    = document.getElementById("modal");
  const img      = document.getElementById("infoImg");
  const tag      = document.getElementById("speciesTag");

  cover.style.backgroundImage = "url('" + COVER_IMAGE + "')";

  function enterApp(push=true){
    cover.classList.add("hide");
    setTimeout(() => { cover.style.display = "none"; }, 480);
    backHint.classList.add("show");
    if (push) history.pushState({page:"app"}, "", "#app");
  }
  function goCover(push=true){
    if (modal.classList.contains("open")) closeModal();
    backHint.classList.remove("show");
    cover.style.display = "flex";
    requestAnimationFrame(() => cover.classList.remove("hide"));
    if (push) history.pushState({page:"cover"}, "", "#cover");
  }

  if (location.hash === "#app") {
    cover.style.display = "none";
    backHint.classList.add("show");
  }

  cover.addEventListener("click", () => enterApp(true));
  document.addEventListener("keydown", (e) => {
    const k = e.key.toLowerCase ? e.key.toLowerCase() : e.key;
    if (cover.style.display !== "none" && (k === "enter" || k === " ")) enterApp(true);
  });

  function backHintActivate(){ goCover(true); }
  backHint.addEventListener("click", backHintActivate);
  backHint.addEventListener("keydown", e => { if (e.key === "Enter" || e.key === " ") backHintActivate(); });

  document.addEventListener("keydown", (e) => {
    const k = e.key.toLowerCase ? e.key.toLowerCase() : e.key;
    if (k === "h") goCover(true);
    else if (k === "escape") { if (modal.classList.contains("open")) closeModal(); else goCover(true); }
  });

  window.addEventListener("popstate", () => {
    if (location.hash === "#cover") goCover(false);
    else if (location.hash === "#app") enterApp(false);
  });

  document.getElementById("btnClose").addEventListener("click", closeModal);
  modal.addEventListener("click", e => { if (e.target === modal) closeModal(); });
  function closeModal(){ modal.classList.remove("open"); document.body.style.overflow = ""; }

  const IMG_MAP = {
    amanita_abrupta:          ["images/amanita_abrupta.png"],
    amanita_muscaria:         ["images/amanita_muscaria.png"],
    amanita_pantherina:       ["images/amanita_pantherina.png"],
    amanita_phalloides:       ["images/amanita_phalloides.png"],
    chlorophyllum_molybdites: ["images/chlorophyllum_molybdites.png"],
    conocybe_filaris:         ["images/conocybe_filaris.png"],
    entoloma_sinuatum:        ["images/entoloma_sinuatum.png"],
    entoloma_sinuatumm:        ["images/entoloma_sinuatumm.png"],
    galerina_marginata:       ["images/galerina_marginata.png"],
    gomphus_fujisanensis:     ["images/gomphus_fujisanensis.png"],
    gyromitra_esculenta:      ["images/gyromitra_esculenta.png"],
    lepiota_brunneoincarnata: ["images/lepiota_brunneoincarnata.png"],
    mycena_pura:              ["images/mycena_pura.png"],
    omphalotus_olearius:      ["images/omphalotus_olearius.png"],
    podostroma_cornudamae:    ["images/podostroma_cornudamae.png"],
    pseudosperma_rimosum:     ["images/pseudosperma_rimosum.png"],
    ramaria_formosa:          ["images/ramaria_formosa.png"],
    scleroderma_citrinum:     ["images/scleroderma_citrinum.png"]
  };

  Object.values(IMG_MAP).flat().concat([COVER_IMAGE]).forEach(src => { const im = new Image(); im.src = src; });

  const titleFromId = id => id.split("_").map(w => w[0].toUpperCase() + w.slice(1)).join(" ");

  function openCard(id){
    const list = IMG_MAP[id];
    if (!list || !list.length) return;
    tag.textContent = titleFromId(id);
    img.src = list[0];
    img.alt = tag.textContent + " information card";
    modal.classList.add("open");
    document.body.style.overflow = "hidden";
  }
  function bindClick(el, id){
    el.classList.add("svg-hot");
    el.setAttribute("tabindex","0");
    el.setAttribute("title", titleFromId(id));
    const open = () => openCard(id);
    el.addEventListener("click", open);
    el.addEventListener("keypress", e => { if (e.key === "Enter" || e.key === " ") open(); });
  }

  fetch(SVG_FILE)
    .then(r => r.text())
    .then(txt => {
      svgWrap.innerHTML = txt;
      const svg = svgWrap.querySelector("svg");
      if (!svg) throw new Error("SVG tag not found");
      Object.keys(IMG_MAP).forEach(id => {
        const el = svg.getElementById(id);
        if (el) bindClick(el, id);
        else console.warn("ID not found in SVG:", id);
      });
    })
    .catch(err => {
      console.error(err);
      alert("SVG load failed. Please run with VS Code Live Server.");
    });
})();
</script>
</body>
</html>
